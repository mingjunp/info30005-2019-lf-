<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.2/css/bootstrapValidator.min.css"/>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.2/js/bootstrapValidator.min.js"></script>
    <title>Find Toilets</title>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="../CSS/homepage.css">
    <script>

        //初始化表单验证
        $(document).ready(function () {
            formValidator();
            /*手动验证表单，当是普通按钮时。*/
            $('#register').data('bootstrapValidator').validate();//启用验证
        });
        //form验证规则
        function formValidator() {
            $("#register").bootstrapValidator({
                message: 'This value is not valid',//默认提示信息
                feedbackIcons: {//提示图标
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    userName: {//名称校验
                        message: 'fail',
                        validators: {//验证条件
                            notEmpty: {
                                message: 'username cannot be empty'
                            },
                            stringLength: {
                                min: 1,
                                max: 30,
                                message: 'cannot over 30 chars'
                            },
                            threshold: 2,//有2字符以上才发送ajax请求
                            remote: {//ajax验证。server result:{"valid",true or false}
                                url: "http://192.168.1.106:3000/api/users/checkUserName",
                                message: 'username exist, please try again',
                                delay: 1000,//ajax刷新的时间是1秒一次
                                type: 'GET',
                                //自定义提交数据，默认值提交当前input value
                                data: function(validator) {
                                    return {
                                        userName : $("#ruserName").val(),
                                    };
                                }
                            }
                        }
                    },
                    password: {
                        validators: {
                            identical: {
                                field: 'password2',
                                message: 'consist your password'
                            }
                        }
                    },
                    password2: {
                        validators: {
                            identical: {
                                field: 'password',
                                message: 'consist your password'
                            }
                        }
                    }

                    // appendant_price: {
                    //     message: '价格验证失败',
                    //     validators: {
                    //         notEmpty: {
                    //             message: '附属品价格不能为空'
                    //         },
                    //         stringLength: {
                    //             min: 1,
                    //             max: 5,
                    //             message: '价格不能超过5位'
                    //         },
                    //         regexp: {//自定义校验
                    //             regexp: /^[0-9]*$/,//正则表达式
                    //             message: '附属品价格只能为数字'
                    //         }
                    //     }
                    // },
                },
            })
        }



        function singup(){

            var flag = $('#register').data('bootstrapValidator').isValid()//验证是否通过true/false
            if (flag == false){
                return;
            } else{
                var formObject = {};
                var formArray =$("#myForm").serializeArray();
                $.each(formArray,function(i,item){
                    formObject[item.name] = item.value;
                });
                $.ajax({
                    url:'http://192.168.1.106:3000/api/users/createUser',
                    type:'post',
                    contentType: "application/json; charset=utf-8",
                    dataType:'json',
                    data:JSON.stringify(formObject),
                    success:function(result){
                        // sign up fail
                        if (result.errno == -1){
                            alert(result.message);
                        }
                        // sign up success
                        if (result.errno == 0){
                            //alert(result.data);
                            $('#infoModal').modal('show');
                            $('#register').modal('hide');
                        }
                        console.log(result);
                    },
                    error:function(e){
                        console.log(e);
                    },
                });
            }
        }

    </script>
</head>

<body>
<!--header-->
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <ul class="nav navbar-nav">
            <li>
                <a href="#"><span class="glyphicon glyphicon-home"></span></a>
            </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
            <li><a data-toggle="modal" data-target="#login" href=""><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
            <li><a data-toggle="modal" data-target="#register" href=""><span class="glyphicon glyphicon-user"></span>Sign up</a></li>
        </ul>
    </div>
</nav>
<!---->
<div class="modal fade" id="infoModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Info</h3>
            </div>
            <div class="modal-body">
                <p>Sign up Success!</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-info" data-dismiss="modal">close</button>
            </div>
        </div>
    </div>
</div>

<!--Sign up pop-up window-->
<div id="register" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <button class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-title">
                <h1 class="text-center">Sign up</h1>
            </div>
            <div class="modal-body">
                <form id="myForm" class="form-group" action="">
                    <div class="form-group">
                        <label for="">User Name</label>
                        <input class="form-control" id="ruserName" name="userName" type="text" required placeholder="Enter your user name">
                    </div>
                    <div class="form-group">
                        <label for="">Password</label>
                        <input class="form-control" name="password" type="password" placeholder="Enter your password">
                    </div>
                    <div class="form-group">
                        <label for="">Enter password again</label>
                        <input class="form-control" name="password2" type="password" placeholder="Enter your password">
                    </div>
                    <div class="text-right">
                        <input class="btn btn-primary" onclick="singup()" value="Sign Up">
                        <input class="btn btn-danger" data-dismiss="modal" value="Cancel">
                    </div>
                    <br>
                    <a href="" data-toggle="modal" data-dismiss="modal" data-target="#login">Already having an account? Click here to login</a>
                </form>
            </div>
        </div>
    </div>
</div>
<!--Login pop-up window-->
<div id="login" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <button class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-title">
                <h1 class="text-center">Login</h1>
            </div>
            <div class="modal-body">
                <form class="form-group" action="">
                    <div class="form-group">
                        <label for="">User Name</label>
                        <input class="form-control" type="text" placeholder="Username">
                    </div>
                    <div class="form-group">
                        <label for="">Password</label>
                        <input class="form-control" type="password" placeholder="Password">
                    </div>
                    <div class="text-right">
                        <input class="btn btn-primary" onclick="login()" value="Login">
                        <input class="btn btn-danger" data-dismiss="modal" value="Cancel">
                    </div>
                    <br>
                    <a href="" data-toggle="modal" data-dismiss="modal" data-target="#register">Don't have an account? Click here to sign up</a>
                </form>
            </div>
        </div>
    </div>
</div>

<!--content-->
<div class="content">
    <!--logo and slogan-->
    <div class="image"><img id="image" src=" ../images/1.png" alt="logo"></div>
    <div>
        <h2>Really need to go!!</h2>
    </div>
    <!--search box-->
    <div class="search">
        <input id="pac-input" class="controls" type="text" placeholder="Enter location to search">
    </div>
    <!--filter selections-->
    <div class="filter checkbox-custom checkbox-default">
        <p>Please select tags from below, or type street names on search box</p>
        <label class="checkbox-inline">
            <input type="checkbox" id="female" name="filter" value="female">female
        </label>
        <label class="checkbox-inline">
            <input type="checkbox" id="male" name="filter" value="male">male
        </label>
        <label class="checkbox-inline">
            <input type="checkbox" id="wheelchair" name="filter" value="wheelchair">wheelchair
        </label>
        <label class="checkbox-inline">
            <input type="checkbox" id="shower" name="filter" value="shower">shower
        </label>
        <label class="checkbox-inline">
            <input type="checkbox" id="babyFacility" name="filter" value="baby_facil">baby facility
        </label>
    </div>
</div>
<!--google map part-->
<div id="mapHolder" class="mapContainer col-lg-11">
    <div id="map"></div>
</div>
<!--group information-->
<div class="footer">
    <h5>Group Name: Les Filles</h5>
    <div>Group Member: Siyuan Duan, Mingjun Pan, Jingwen Fu, Yang Zhao</div>
</div>
<!--link javascript at bottom to increase loading speed-->
<script src="./JS/mapcontrol.js"></script>
</body>
</html>