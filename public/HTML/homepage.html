<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.2/css/bootstrapValidator.min.css"/>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.2/js/bootstrapValidator.min.js"></script>
    <script src="./JS/signup.js"></script>
    <script src="./JS/checkLogin.js"></script>
    <title>Find Toilets</title>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="../CSS/homepage.css">
    <script>
        checkLogin();
        function login(){
            var formObject = {};
            var formArray =$("#login-form").serializeArray();
            $.each(formArray,function(i,item){
                formObject[item.name] = item.value;
            });
            $.ajax({
                url:'http://localhost:3000/api/users/login',
                type:'post',
                contentType: "application/json; charset=utf-8",
                dataType:'json',
                data:JSON.stringify(formObject),
                success:function(result){
                    // login fail
                    if (result.errno == -1){
                        alert(result.message);
                    }
                    // login success
                    if (result.errno == 0){
                        $('#nav-right').children('li').remove();
                        $('#nav-right').append($(`<li><p class="navbar-text">Hi, <a href="#" class="navbar-link">`+ result.data.userName +`</a></p></li>
                            <li><a href="#"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>`));

                        $('#login').modal('hide');
                    }
                    console.log(result);
                },
                error:function(e){
                    console.log(e);
                },
            });

        }
    </script>
</head>

<body>
<!--header-->
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <ul class="nav navbar-nav">
            <li>
                <a href="#"><span class="glyphicon glyphicon-home"></span></a>
            </li>
        </ul>
        <ul id="nav-right" class="nav navbar-nav navbar-right">
            <li><a data-toggle="modal" data-target="#login" href=""><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
            <li><a data-toggle="modal" data-target="#register" href=""><span class="glyphicon glyphicon-user"></span>Sign up</a></li>
        </ul>
    </div>
</nav>
<!---->
<div class="modal fade" id="infoModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Info</h3>
            </div>
            <div class="modal-body">
                <p>Sign up Success!</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-info" data-dismiss="modal">close</button>
            </div>
        </div>
    </div>
</div>

<!--Sign up pop-up window-->
<div id="register" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <button class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-title">
                <h1 class="text-center">Sign up</h1>
            </div>
            <div class="modal-body">
                <form id="myForm" class="form-group" action="">
                    <div class="form-group">
                        <label for="">User Name</label>
                        <input class="form-control" id="ruserName" name="userName" type="text" required placeholder="Enter your user name">
                    </div>
                    <div class="form-group">
                        <label for="">Password</label>
                        <input class="form-control" name="password" type="password" placeholder="Enter your password">
                    </div>
                    <div class="form-group">
                        <label for="">Enter password again</label>
                        <input class="form-control" name="password2" type="password" placeholder="Enter your password">
                    </div>
                    <div class="text-right">
                        <input class="btn btn-primary" onclick="singup()" value="Sign Up">
                        <input class="btn btn-danger" data-dismiss="modal" value="Cancel">
                    </div>
                    <br>
                    <a href="" data-toggle="modal" data-dismiss="modal" data-target="#login">Already having an account? Click here to login</a>
                </form>
            </div>
        </div>
    </div>
</div>
<!--Login pop-up window-->
<div id="login" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <button class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-title">
                <h1 class="text-center">Login</h1>
            </div>
            <div class="modal-body">
                <form id="login-form" class="form-group" action="">
                    <div class="form-group">
                        <label for="">User Name</label>
                        <input class="form-control" name="userName" type="text" placeholder="Username">
                    </div>
                    <div class="form-group">
                        <label for="">Password</label>
                        <input class="form-control" name="password" type="password" placeholder="Password">
                    </div>
                    <div class="text-right">
                        <input class="btn btn-primary" onclick="login()" value="Login">
                        <input class="btn btn-danger" data-dismiss="modal" value="Cancel">
                    </div>
                    <br>
                    <a href="" data-toggle="modal" data-dismiss="modal" data-target="#register">Don't have an account? Click here to sign up</a>
                </form>
            </div>
        </div>
    </div>
</div>

<!--content-->
<div class="content">
    <!--logo and slogan-->
    <div class="image"><img id="image" src=" ../images/1.png" alt="logo"></div>
    <div>
        <h2>Really need to go!!</h2>
    </div>
    <!--search box-->
    <div class="search">
        <input id="pac-input" class="controls" type="text" placeholder="Enter location to search">
    </div>
    <!--filter selections-->
    <div class="filter checkbox-custom checkbox-default">
        <p>Please select tags from below, or type street names on search box</p>
        <label class="checkbox-inline">
            <input type="checkbox" id="female" name="filter" value="female">female
        </label>
        <label class="checkbox-inline">
            <input type="checkbox" id="male" name="filter" value="male">male
        </label>
        <label class="checkbox-inline">
            <input type="checkbox" id="wheelchair" name="filter" value="wheelchair">wheelchair
        </label>
        <label class="checkbox-inline">
            <input type="checkbox" id="shower" name="filter" value="shower">shower
        </label>
        <label class="checkbox-inline">
            <input type="checkbox" id="babyFacility" name="filter" value="baby_facil">baby facility
        </label>
    </div>
</div>
<!--google map part-->
<div id="mapHolder" class="mapContainer col-lg-11">
    <div id="map"></div>
</div>
<!--group information-->
<div class="footer">
    <h5>Group Name: Les Filles</h5>
    <div>Group Member: Siyuan Duan, Mingjun Pan, Jingwen Fu, Yang Zhao</div>
</div>
<!--link javascript at bottom to increase loading speed-->
<script src="./JS/mapcontrol.js"></script>
</body>
</html>